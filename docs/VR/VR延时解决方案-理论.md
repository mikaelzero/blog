**VR 的延时是什么？**

正常情况下, 在 android 的手机中使用的是双缓冲和三缓冲, 流水线如下：

![](https://raw.githubusercontent.com/mikaelzero/ImageSource/main/202211031426433.jpg)

那么一帧的图像, 从开始绘制之前到显示到屏幕要花费至少 3 个周期, 也就是 3\*16.6ms.

那么这里就是所谓的延时, 显示和合成在 app 层无法改动, 那么绘制部分的流水线就是需要优化的点.

**使用单缓冲**

单缓冲可以有效地减少延时, 因为双缓冲是需要等待 vsync 再进行提交数据, 而单缓冲窗口随时可以自己控制提交的时机, 单缓冲的最大问题就是画面撕裂.

**解决撕裂方案**

默认的 android 系统下, 解决撕裂的方案是双缓冲配合 vsync 信号, 在单缓冲的情况下, 我们也可以配合使用 vsync 信号.

首先, vsync 信号代表的是显示器已经渲染结束, 在一个 60hz 刷新率的显示器下, 大约需要小于 16.6ms 的时间来做显示屏的画面显示, 那么一半的显示就是大约 8.3ms 的时间；

其次, 撕裂的原因主要是由于在单缓冲的情况下, display 和 render 使用的是同一个缓冲区, 那么当我显示屏在刷新画面的时候, 有可能我已经把下一帧的画面给渲染了, 那么显示屏读取到的数据就是下一帧的数据, 那么画面上就会出现一半是当前帧, 一半是下一帧, 如下图所示：

![](https://raw.githubusercontent.com/mikaelzero/ImageSource/main/202211031426230.jpg)

因此, 解决撕裂需要 vsync 和 strip 渲染.

流程大致如下：

当开始显示第 N 帧的下半部分时, 绘制 N+1 的上半帧, Vsync 到了之后, 显示 N+1 的上半帧, 期间要绘制 N+1 的下半帧

![](https://raw.githubusercontent.com/mikaelzero/ImageSource/main/202211031427893.jpeg)

可以看出, 是按照层级来渲染的, 分成了上下两层, 以这样的方式, 当我渲染的时候就不会影响到显示, 由于需要跟着显示的频率来走, 所以需要 vsync 的配合.
